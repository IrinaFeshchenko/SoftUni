@model Chat.Models.Profile.ProfileIndexView
@{
	ViewData["Title"] = "Profile";
}

<div class="chatMainBox">
	<div class="chatContactsBox">
		<h4 class="well">CONTACTS</h4>
		<ul class="scrollable-menu">
			@foreach (var contact in Model.Contacts)
			{
				<li class="btn chatContact">
					<div id="@contact.Id">
						<img src="@Url.Content(contact.Avatar)" alt="Image" class="avatar" />
						<label>@contact.NickName</label>
					</div>
				</li>
			}
		</ul>
	</div>
	<div class="chatContentBox">
		<div class="chatDisplayBox scrollable-menu">
			<div class="chatDisplayMessages scrollable-menu">
				<ul id="messages"></ul>
			</div>
			<div class="chatDisplayInfo">
				<h4 class="well">CONTACT INFO</h4>
				<div id="profileInfoPanel" class="hidden">
					<img id="profileImage" /><br />
					<label id="profileName"></label><br />
					<label id="profileEmail"></label><br />
					<label id="profileRegisteredOn"></label><br />
					<label id="profileContactsCount"></label><br />
					<input type="hidden" id="FriendId" value="" />
					<input class="btn-info btn btn-sm" id="removeContact" value="Remove Contact" />
				</div>
			</div>
		</div>
		<div class="chatSendMessage">
			<input type="text" id="message" value="" />
			<button id="send-message">Send</button>
		</div>
	</div>
</div>


<script src="~/lib/signalr/dist/browser/signalr.js"></script>
<script src="~/js/chat.js"></script>

<script type="text/javascript">
	$(document).ready(function () {

		$('.chatContact').on('click', 'div', function () {
			let selectedProfileId = this.id;

			$.ajax({
				type: 'POST',
				url: '@Url.Action("AjaxGetProfileInfo", "Profile", new { area = "" })',
				dataType: "json",
				data: { selectedId: selectedProfileId },
				success: successFunc,
				error: errorFunc
			});

			function successFunc(data) {
				$('#profileImage').attr('src', data.avatar);
				$('#profileName').text('Name: ' + data.name);
				$('#profileEmail').text('Email: ' + data.email);
				$('#profileRegisteredOn').text('Registered: ' + data.registeredOn);
				$('#profileContactsCount').text('Contacts: ' + data.contactsCount);
				$('#profileInfoPanel').removeClass('hidden');
				$('#FriendId').val(selectedProfileId);
			}

			function errorFunc() {
			}

		});

		$('#removeContact').on('click', function () {
			let friendId = $('#FriendId').val();
			let userId = "@Model.Id";

			$.ajax({
				type: 'POST',
				url: '@Url.Action("AjaxRemoveContact", "Profile", new { area = "" })',
				dataType: "json",
				data: { contactId: friendId, userId: userId },
				success: successFunc,
				error: errorFunc
			});

			function successFunc(data) {
				$('#profileInfoPanel').addClass('hidden');
				$('#' + friendId).parent().remove();
			}

			function errorFunc() {
			}

		});

		$('#send-message').on('click', function () {

			let message = $('#message').val();
			$('#message').val('');

			if (message) {

				$('#messages').prepend('<li class="chatMessage"><img src="@Model.Avatar" alt="Image" class="messageAvatar" /><div class="message">' + message + '<div></li>');
			}
		});
	});
</script>
